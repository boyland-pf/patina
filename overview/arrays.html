<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Arrays - The Patina Programming Language</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../overview/overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/integer.html"><strong aria-hidden="true">1.1.</strong> Integer Expressions</a></li><li class="chapter-item expanded "><a href="../overview/boolean.html"><strong aria-hidden="true">1.2.</strong> Boolean Expressions</a></li><li class="chapter-item expanded "><a href="../overview/unit.html"><strong aria-hidden="true">1.3.</strong> Unit Expressions</a></li><li class="chapter-item expanded "><a href="../overview/arrays.html" class="active"><strong aria-hidden="true">1.4.</strong> Arrays</a></li><li class="chapter-item expanded "><a href="../overview/functions.html"><strong aria-hidden="true">1.5.</strong> Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../ref.html"><strong aria-hidden="true">2.</strong> Reference Manual</a></li><li class="chapter-item expanded "><a href="../setup/setup.html"><strong aria-hidden="true">3.</strong> Setting up OCaml</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../setup/opam.html"><strong aria-hidden="true">3.1.</strong> Installing opam</a></li><li class="chapter-item expanded "><a href="../setup/ocaml.html"><strong aria-hidden="true">3.2.</strong> Installing OCaml</a></li><li class="chapter-item expanded "><a href="../setup/run.html"><strong aria-hidden="true">3.3.</strong> Interacting with OCaml Code</a></li></ol></li><li class="chapter-item expanded "><a href="../assignments/assignments.html"><strong aria-hidden="true">4.</strong> Programming Assignments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../assignments/as1.html"><strong aria-hidden="true">4.1.</strong> Assignment 1: OCaml</a></li><li class="chapter-item expanded "><a href="../assignments/as2.html"><strong aria-hidden="true">4.2.</strong> Assignment 2: Lexing and Parsing</a></li><li class="chapter-item expanded "><a href="../assignments/as3.html"><strong aria-hidden="true">4.3.</strong> Assignment 3: Type Checking</a></li><li class="chapter-item expanded "><a href="../assignments/as4.html"><strong aria-hidden="true">4.4.</strong> Assignment 4: Code Generation</a></li><li class="chapter-item expanded "><a href="../assignments/as5.html"><strong aria-hidden="true">4.5.</strong> Assignment 5: Optimizations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Patina Programming Language</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="arrays"><a class="header" href="#arrays">Arrays</a></h2>
<p>Patina supports dynamically allocated, zero-indexed arrays of integers.</p>
<h3 id="array-allocation"><a class="header" href="#array-allocation">Array Allocation</a></h3>
<p>We can create an array by calling the built-in function <code>alloc(..)</code> with a desired length. All elements will be initialized to <code>0</code>. For example,</p>
<pre><code class="language-rust no_run noplayground">{
  let len: int = 3;
  let xs: [int] = alloc(len)
}
</code></pre>
<p>creates an array of length <code>3</code> and binds it to variable <code>xs</code>.</p>
<h3 id="reading-from-an-array"><a class="header" href="#reading-from-an-array">Reading from an Array</a></h3>
<p>Array elements can be accessed using <em>array-access expressions</em>, written as</p>
<pre><code class="language-rust no_run noplayground">xs[i]
</code></pre>
<p>where <code>xs</code> is an array, and <code>i</code> is an integer expression.</p>
<h3 id="writing-to-an-array-element"><a class="header" href="#writing-to-an-array-element">Writing to an Array Element</a></h3>
<p>When an array access appears on the left-hand side of an assignment, the selected array element can be mutated, just like how the value of a variable is mutated. For example,</p>
<pre><code class="language-rust no_run noplayground">{
  let singleton: [int] = alloc(1);
  singleton[0] = 100
}
</code></pre>
<p>changes the 0-th element of <code>singleton</code> from the default value of <code>0</code> to <code>100</code>.</p>
<h3 id="aliasing"><a class="header" href="#aliasing">Aliasing</a></h3>
<p>Aliasing is permitted in Patina. Two array variables can simultaneously refer to the same array object:</p>
<pre><code class="language-rust no_run noplayground">{
  let xs: [int] = alloc(1);
  let ys: [int] = xs; // ys refers to the same array as xs
  ...
}
</code></pre>
<p>Arrays are passed by reference. So <code>[int]</code> is like a pointer to integer (<code>int *</code>) in C++. In the following example, both <code>reverse_1</code> and <code>reverse_2</code> reverses the input array. However, <code>reverse_1</code> modifies the input array <em>in place</em>, while <code>reverse_2</code> returns a <em>new</em> array that's the reverse of the input array.</p>
<pre><code class="language-rust no_run noplayground">fn reverse_1(xs: [int], len: int) -&gt; unit {
  let mid: int = len / 2;
  let i: int = 0;
  while i &lt; mid {
    xs[i] = xs[len - i - 1];
    i = i + 1
  }
}

fn reverse_2(xs: [int], len: int) -&gt; [int] {
  let ys: [int] = alloc(len);
  let i: int = 0;
  while i &lt; len {
    ys[i] = xs[len - i - 1];
    i = i + 1
  };
  ys
}
</code></pre>
<h3 id="extent"><a class="header" href="#extent">Extent</a></h3>
<p>Because you're not required to implement a garbage collector for your compiler, arrays will have infinite extent. In other words, an array cannot be destroyed once it has been allocated.</p>
<p>In the following example, even after the function <code>f</code> has returned, the array referred to by <code>xs</code> inside the body of <code>f</code> continues to exist in heap memory. But we can't access the array again, because its only name <code>xs</code> is no longer available outside the function body:</p>
<pre><code class="language-rust no_run noplayground">fn f() -&gt; unit {
  let xs: [int] = alloc(1); // xs refers to an array in heap memory
  ()
}

fn main() -&gt; unit {
  f();
  ... // can't refer to that array anymore, since xs is out-of-scope
}
</code></pre>
<p>Once we've created an array, unless we always remember its name (or one of its names), the array would become an unnameable identity forever lost in heap memory. This is what's called a <a href="https://en.wikipedia.org/wiki/Memory_leak">memory leak</a>, which plagues programs written in unmanaged languages like C and C++. You will learn about solutions to this problem in the second half of the course, although you won't be required to implement them <sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Also, learn how Rust prevents resource leaks using a <a href="https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html">completely different approach</a>. It's super cool!</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../overview/unit.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../overview/functions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../overview/unit.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../overview/functions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
